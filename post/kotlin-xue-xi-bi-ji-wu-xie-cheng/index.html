<!DOCTYPE html>
<html lang="zh-CN">
	<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,minimal-ui" />
    <title>Kotlinå­¦ä¹ ç¬”è®°äº”-åç¨‹ | Helloå•Šï¼Œæ ‘å“¥</title>
<link rel='stylesheet' id='puma-css'  href='https://rhizophora.github.io//styles/main.css' type='text/css' media='screen' />
<link rel='stylesheet' id='puma-css'  href='https://at.alicdn.com/t/font_1306644_jwtuc2zzbrd.css' media='screen' />
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<script type='text/javascript' src='https://rhizophora.github.io//media/scripts/jquery.js'></script>
<script type='text/javascript' src='https://rhizophora.github.io//media/scripts/jquery-migrate.min.js'></script>
        <script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
         <script >hljs.initHighlightingOnLoad();</script>
         
</head>
<body class="single single-post postid-3788 single-format-standard">
	<!--åŠ å…¥è·Ÿéšæ»‘åŠ¨çš„é¡¶éƒ¨-->
	<header id="masthead" class="site-header" role="banner">
		<div class="site-branding">
			<h1 class="site-title">
				<a href="https://rhizophora.github.io/" title="Helloå•Šï¼Œæ ‘å“¥">Helloå•Šï¼Œæ ‘å“¥</a>
			</h1>
		</div>

		<a class="primary-nav-trigger" href="javascript:void(0)">
			<span class="menu-icon"></span>
		</a>
		
	</header>
		<div class="site-navigation-wrapper">
		<nav id="site-navigation" class="main-navigation" role="navigation">
			<ul class="primary-nav">
                    
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="é¦–é¡µ" href="/">é¦–é¡µ</a></li>
                
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="å½’æ¡£" href="/archives">å½’æ¡£</a></li>
                
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="æ ‡ç­¾" href="/tags">æ ‡ç­¾</a></li>
                
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="å…³äº" href="/post/about">å…³äº</a></li>
                
	
			</ul>
		</nav>			
	</div>
	<!--è·Ÿéšæ»‘åŠ¨çš„é¡¶éƒ¨ç»“æŸ-->
	<div class="surface-content">    <main class="main-content">
        <section class="section-body">
                            <header class="section-header u-textAlignCenter">
                    <h2 class="grap--h2">Kotlinå­¦ä¹ ç¬”è®°äº”-åç¨‹</h2>
                    <div class="block-postMetaWrap">
                        <time>2020-04-30</time>
                    </div>
                </header>
                <div class="grap">
					
					<p>åç¨‹æ˜¯kotlinéå¸¸ç‰¹åˆ«çš„ä¸€éƒ¨åˆ†ï¼Œå’Œjavaç›¸æ¯”ï¼Œå®ƒæ˜¯ä¸ªå…¨æ–°çš„æ¦‚å¿µã€‚</p>
<p>åç¨‹è®¾è®¡çš„åˆè¡·å°±æ˜¯ä¸ºäº†è§£å†³å¹¶å‘é—®é¢˜ï¼Œè®©åä½œå¼å¤šä»»åŠ¡å®ç°èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚</p>
<p>åç¨‹æ˜¯kotlinæä¾›çš„ä¸€å¥—çº¿ç¨‹å°è£…çš„api,ä½†å¹¶ä¸æ˜¯è¯´åç¨‹å°±æ˜¯ä¸ºçº¿ç¨‹è€Œç”Ÿçš„ã€‚</p>
<p>ä½¿ç”¨åç¨‹è¿›è¡Œç½‘ç»œè¯·æ±‚åˆ·æ–°uiçš„ä¾‹å­</p>
<pre><code class="language-kotlin">launch({
    val user = api.getUser() // ğŸ‘ˆ ç½‘ç»œè¯·æ±‚ï¼ˆIO çº¿ç¨‹ï¼‰
    nameTv.text = user.name  // ğŸ‘ˆ æ›´æ–° UIï¼ˆä¸»çº¿ç¨‹ï¼‰
})
</code></pre>
<p>launchå¹¶ä¸æ˜¯ä¸€ä¸ªé¡¶å±‚å‡½æ•°ï¼Œå®ƒå¿…é¡»åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ä½¿ç”¨ã€‚launchå‡½æ•°åŠ ä¸Šæ˜¯ç°åœ¨{}ä¸­çš„å…·ä½“é€»è¾‘ï¼Œå°±æ„æˆäº†ä¸€ä¸ªåç¨‹ã€‚</p>
<p>åç¨‹çš„åŸºæœ¬ä½¿ç”¨</p>
<pre><code class="language-kotlin">// æ–¹æ³•ä¸€ï¼Œä½¿ç”¨ runBlocking é¡¶å±‚å‡½æ•°
runBlocking {
    getImage(imageId)
}

// æ–¹æ³•äºŒï¼Œä½¿ç”¨ GlobalScope å•ä¾‹å¯¹è±¡
//            ğŸ‘‡ å¯ä»¥ç›´æ¥è°ƒç”¨ launch å¼€å¯åç¨‹
GlobalScope.launch {
    getImage(imageId)
}

// æ–¹æ³•ä¸‰ï¼Œè‡ªè¡Œé€šè¿‡ CoroutineContext åˆ›å»ºä¸€ä¸ª CoroutineScope å¯¹è±¡
//                                    ğŸ‘‡ éœ€è¦ä¸€ä¸ªç±»å‹ä¸º CoroutineContext çš„å‚æ•°
val coroutineScope = CoroutineScope(context)
coroutineScope.launch {
    getImage(imageId)
}
</code></pre>
<p>æ–¹æ³•ä¸€é€šå¸¸é€‚ç”¨äºå•å…ƒæµ‹è¯•çš„åœºæ™¯ï¼Œä¸šåŠ¡å¼€å‘ä¸ä¼šç”¨åˆ°è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ˜¯çº¿ç¨‹é˜»å¡çš„ã€‚</p>
<p>æ–¹æ³•äºŒå’Œä½¿ç”¨runBlockingçš„åŒºåˆ«åœ¨äºä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚ä½†æ˜¯åœ¨Androidå¼€å‘ä¸­åŒæ ·ä¸æ¨èè¿™ç§ç”¨æ³•ï¼Œå› ä¸ºå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¼šå’Œappä¸€è‡´ï¼Œè€Œä¸”ä¸èƒ½å–æ¶ˆã€‚</p>
<p>æ–¹æ³•ä¸‰æ˜¯æ¯”è¾ƒæ¨èçš„ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡contextå‚æ•°å»ç®¡ç†å’Œæ§åˆ¶åç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼ˆè¿™é‡Œçš„contextå’Œandroidé‡Œçš„ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œæ˜¯ä¸€ä¸ªæ›´é€šç”¨çš„æ¦‚å¿µï¼Œæœ‰ä¸€ä¸ªandroidå¹³å°çš„å°è£…æ¥é…åˆä½¿ç”¨ï¼‰ã€‚</p>
<p>åç¨‹æœ€å¸¸ç”¨çš„åŠŸèƒ½æ˜¯å¼€å‘ï¼Œè€Œå¹¶å‘çš„å…¸å‹åœºæ™¯å°±æ˜¯å¤šçº¿ç¨‹ã€‚å¯ä»¥ä½¿ç”¨Dispatchers.IOå‚æ•°æŠŠä»»åŠ¡åˆ‡åˆ°IOçº¿ç¨‹æ‰§è¡Œã€‚</p>
<pre><code class="language-kotlin">coroutineScope.launch(Dispatchers.IO) {
    ...
}
</code></pre>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Dispatchers.Mainå‚æ•°åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ï¼š</p>
<pre><code class="language-kotlin">coroutineScope.launch(Dispatchers.Main) {
    ...
}
</code></pre>
<p>æ‰€ä»¥ä¸€ä¸ªå®Œæ•´çš„å¼‚æ­¥è¯·æ±‚ä¾‹å­æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<pre><code class="language-kotlin">coroutineScope.launch(Dispatchers.Main) {   // åœ¨ä¸»çº¿ç¨‹å¼€å¯åç¨‹
    val user = api.getUser() // IO çº¿ç¨‹æ‰§è¡Œç½‘ç»œè¯·æ±‚
    nameTv.text = user.name  // ä¸»çº¿ç¨‹æ›´æ–° UI
}
</code></pre>
<p>javaå†™çš„è¯å°±å¾ˆéš¾å—</p>
<pre><code class="language-java">api.getUser(new Callback&lt;User&gt;() {
    @Override
    public void success(User user) {
        runOnUiThread(new Runnable() {
            @Override
            public void run() {
                nameTv.setText(user.name);
            }
        })
    }
    
    @Override
    public void failure(Exception e) {
        ...
    }
});
</code></pre>
<p>åç¨‹çš„1åˆ°0</p>
<p>å¯¹äºå›è°ƒå¼çš„å†™æ³•ï¼Œå¦‚æœå¹¶å‘åœºæ™¯å†å¤æ‚ä¸€äº›ï¼Œä»£ç çš„åµŒå¥—å¯èƒ½ä¼šæ›´å¤šï¼Œç»´æŠ¤èµ·æ¥ä¼šéå¸¸éº»çƒ¦ã€‚ç”¨åç¨‹å°±ä¼šç®€å•å¤ªå¤šï¼š</p>
<pre><code class="language-kotlin">coroutineScope.launch(Dispatchers.Main) {       // å¼€å§‹åç¨‹ï¼šä¸»çº¿ç¨‹
    val token = api.getToken()                  // ç½‘ç»œè¯·æ±‚ï¼šIO çº¿ç¨‹
    val user = api.getUser(token)               // ç½‘ç»œè¯·æ±‚ï¼šIO çº¿ç¨‹
    nameTv.text = user.name                     // æ›´æ–° UIï¼šä¸»çº¿ç¨‹
}
</code></pre>
<p>å¦‚æœé‡åˆ°çš„åœºæ™¯æ˜¯å¼€å¯å¤šä¸ªç½‘ç»œè¯·æ±‚ï¼Œç­‰å¾…æ‰€æœ‰è¯·æ±‚ç»“æŸä¹‹åå†å¯¹uiæ›´æ–°ï¼Œåˆ©ç”¨åç¨‹å¯ä»¥å§ä¸¤ä¸ªå¹¶è¡Œè¯·æ±‚ç»“æœåˆå¹¶ï¼š</p>
<pre><code class="language-kotlin">coroutineScope.launch(Dispatchers.Main) {
    //            ğŸ‘‡  async å‡½æ•°ä¹‹åå†è®²
    val avatar = async { api.getAvatar(user) }    // è·å–ç”¨æˆ·å¤´åƒ
    val logo = async { api.getCompanyLogo(user) } // è·å–ç”¨æˆ·æ‰€åœ¨å…¬å¸çš„ logo
    val merged = suspendingMerge(avatar, logo)    // åˆå¹¶ç»“æœ
    //                  ğŸ‘†
    show(merged) // æ›´æ–° UI
}
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>suspendingMerge</code> å¹¶ä¸æ˜¯åç¨‹ API ä¸­æä¾›çš„æ–¹æ³•ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªå¯ã€ŒæŒ‚èµ·ã€çš„ç»“æœåˆå¹¶æ–¹æ³•</p>

                </div>

                <div class="post--keywords" itemprop="keywords">
					          </div>



        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '1e614d16da5fc018bcbc',
    clientSecret: 'd5e5bf76bb8430a9ec5454feb2c5da70d63db4c8',
    repo: 'Rhizophora.github.io',
    owner: 'Rhizophora',
    admin: ['Rhizophora'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
                      </section>
    </main>
</div>
	<footer class="site-footer u-textAlignCenter">
    	<div class="footer-branding">
            <a href="https://rhizophora.github.io/" title="Helloå•Šï¼Œæ ‘å“¥">Helloå•Šï¼Œæ ‘å“¥</a>
									<p class="site-description">å¥½å¥½èµšé’±ç©æ¸¸æˆ</p>
			         </div>
		 <hr />
		 <div class="social-links">
		                       
                            
                           
                            
                           
                            	
			<span class="social-link"><a href="https://github.com/Rhizophora" target="_blank"><i class="iconfont icon-github"></i></a></span>	
			                         
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
				</div>
        <div class="footer-copy">
                Powered by <a href="https://github.com/Rhizophora/Rhizophora.github.io" target="_blank">Rhizophora</a>
        </div>

    </footer>
	<div class="back-to-top u-hide" onclick="backToTop();"><i class="iconfont icon-xiangshang"></i></div>

<script type='text/javascript' src='https://rhizophora.github.io//media/scripts/main.js'></script>
</body>
</html>